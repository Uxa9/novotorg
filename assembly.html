<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конструктор</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/splide/splide.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/cakeCard.css">
    <link rel="stylesheet" href="css/assembly.css">
</head>
<body>
    <div class="wrapper">
        <!-- header -->
        <main class="cake-assembler-wrapper">
            <form action="" method="post">
                <h1>Торты на заказ</h1>
                <div class="cake-assembler-and-calculator">
                    <section class="cake-assembler">
                        <header>
                            <p>
                                Соберите свой уникальный торт за несколько минут!
                            </p>
                            <p>
                                Оформить заявку на заказной торт можно минимум за 3
                                дня до нужной Вам даты
                            </p>
                        </header>
                        <div class="cake-assembler-options">
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Форма</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper cake-assembler-option-icons">
                                    <div>
                                        <img src="images/square.svg" alt="">
                                        <span>Квадрат</span>
                                    </div>
                                    <div>
                                        <img src="images/ellipse.svg" alt="">
                                        <span>Круг</span>
                                    </div>
                                    <div>
                                        <img src="images/triangle.svg" alt="">
                                        <span>Треугольник</span>
                                    </div>
                                    <div>
                                        <img src="images/star.svg" alt="">
                                        <span>Другое</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Количество ярусов</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper cake-assembler-option-icons">
                                    <div>
                                        <img src="images/firstTier.svg" alt="">
                                        <span>Квадрат</span>
                                    </div>
                                    <div>
                                        <img src="images/secondTier.svg" alt="">
                                        <span>Круг</span>
                                    </div>
                                    <div>
                                        <img src="images/thirdTier.svg" alt="">
                                        <span>Треугольник</span>
                                    </div>
                                    <div>
                                        <img src="images/fourthTier.svg" alt="">
                                        <span>Другое</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Бисквит</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper">
                                    <div>
                                        <div class="option-image">
                                            <img src="images/classic.png" alt="">
                                        </div>
                                        <span>Классический белый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCream.png" alt="">
                                        </div>
                                        <span>Сметанный</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/honey.png" alt="">
                                        </div>
                                        <span>Медовый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCreamCacao.png" alt="">
                                        </div>
                                        <span>Сметанный с какао</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/milk.png" alt="">
                                        </div>
                                        <span>На сгущенном молоке</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/carrot.png" alt="">
                                        </div>
                                        <span>Морковный с грецким орехом и карамелью</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/redVelvet.png" alt="">
                                        </div>
                                        <span>Красный бархат</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/chokolate.png" alt="">
                                        </div>
                                        <span>Шоколадный</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Крем</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper">
                                    <div>
                                        <div class="option-image">
                                            <img src="images/classic.png" alt="">
                                        </div>
                                        <span>Классический белый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCream.png" alt="">
                                        </div>
                                        <span>Сметанный</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/honey.png" alt="">
                                        </div>
                                        <span>Медовый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCreamCacao.png" alt="">
                                        </div>
                                        <span>Сметанный с какао</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/milk.png" alt="">
                                        </div>
                                        <span>На сгущенном молоке</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/carrot.png" alt="">
                                        </div>
                                        <span>Морковный с грецким орехом и карамелью</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/redVelvet.png" alt="">
                                        </div>
                                        <span>Красный бархат</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/chokolate.png" alt="">
                                        </div>
                                        <span>Шоколадный</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Начинка</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper">
                                    <div>
                                        <div class="option-image">
                                            <img src="images/classic.png" alt="">
                                        </div>
                                        <span>Классический белый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCream.png" alt="">
                                        </div>
                                        <span>Сметанный</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/honey.png" alt="">
                                        </div>
                                        <span>Медовый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCreamCacao.png" alt="">
                                        </div>
                                        <span>Сметанный с какао</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/milk.png" alt="">
                                        </div>
                                        <span>На сгущенном молоке</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/carrot.png" alt="">
                                        </div>
                                        <span>Морковный с грецким орехом и карамелью</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/redVelvet.png" alt="">
                                        </div>
                                        <span>Красный бархат</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/chokolate.png" alt="">
                                        </div>
                                        <span>Шоколадный</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option cake-option-weight">
                                <header>
                                    <h3>Вес</h3>
                                </header>
                                <input 
                                    type="range" 
                                    class="slider" 
                                    id="cakeRange" 
                                    min="1" max="18" step="0.5" value="3"
                                >
                                <div class="output-cake-weight">
                                    <p>3.0 кг</p>
                                    <p>5 порций</p>
                                </div>
                                <div class="cake-weight-selector">
                                    <div>
                                        <p>3 кг</p>
                                        <p>15 порций</p>
                                    </div>
                                    <div>
                                        <p>6 кг</p>
                                        <p>30 порций</p>
                                    </div>
                                    <div>
                                        <p>9 кг</p>
                                        <p>45 порций</p>
                                    </div>
                                    <div>
                                        <p>12 кг</p>
                                        <p>60 порций</p>
                                    </div>
                                    <div>
                                        <p>18 кг</p>
                                        <p>90 порций</p>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Оформление торта</h3>
                                </header>
                                <div>
                                    <ul class="selector">
                                        <li class="selector-selected">Все</li>
                                        <li>Детские</li>
                                        <li>Для женщин</li>
                                    </ul>
                                    <div id="image-slider" class="splide">
                                        <div class="splide__track">
                                            <ul class="splide__list">
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                                <li class="splide__slide">
                                                    <div class="option-image">
                                                        <img src="images/chokolate.png" alt="">
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Торт можно украсить</h3>
                                </header>
                                <div class="cake-assembler-option-wrapper">
                                    <div>
                                        <div class="option-image">
                                            <img src="images/classic.png" alt="">
                                        </div>
                                        <span>Классический белый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCream.png" alt="">
                                        </div>
                                        <span>Сметанный</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/honey.png" alt="">
                                        </div>
                                        <span>Медовый</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/sourCreamCacao.png" alt="">
                                        </div>
                                        <span>Сметанный с какао</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/milk.png" alt="">
                                        </div>
                                        <span>На сгущенном молоке</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/carrot.png" alt="">
                                        </div>
                                        <span>Морковный с грецким орехом и карамелью</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/redVelvet.png" alt="">
                                        </div>
                                        <span>Красный бархат</span>
                                    </div>
                                    <div>
                                        <div class="option-image">
                                            <img src="images/chokolate.png" alt="">
                                        </div>
                                        <span>Шоколадный</span>
                                    </div>
                                </div>
                            </article>
                            <article class="cake-assembler-option">
                                <header>
                                    <h3>Дополнительные пожелания</h3>
                                </header>
                                <div>
                                    <textarea 
                                        name="" id="" 
                                        placeholder="Например, надпись на торте"
                                    ></textarea>
                                    <div id="dropArea" class="drag-n-drop">
                                        <p>Прикрепить изображение</p>
                                        <input type="file" id="fileElem" multiple accept="image/*">
                                        <div id="gallery"></div>
                                        <label class="dnd-button" for="fileElem"></label>
                                        <p>
                                            Загрузите или перетащите 
                                            сюда ваше изображние,
                                            и мы нанесем его на торт
                                        </p>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </section>
                    <section class="price-calculator">
                        <header>
                            Мой торт
                        </header>
                        <div class="my-cake-params">
                            <div class="my-cake-weight">
                                <span>Примерный вес</span>
                                <span>3 600 кг</span>
                            </div>
                            <div class="my-cake-price">
                                <span>Примерная стоимость</span>
                                <span>582 ₽</span>
                            </div>
                        </div>
                        <input class="my-cake-order-button" type="submit" value="Оформить заказ">
                        <footer>
                            <p>
                                Оператор проверит и уточнит все данные, 
                                после чего свяжется с вами, чтобы согласовать 
                                точную стоимость
                            </p>
                        </footer>
                    </section>
                </div>
            </form>
        </main>
        <!-- footer -->
    </div>

    <!-- Переключатель размера торта -->
    <script> 
        let cakeWeight = document.getElementById('cakeRange');
        let cakeWeightValue = document.querySelector('.cake-weight-selector').children;
        let outputCakeWeight = document.querySelector('.output-cake-weight');

        Array.from(cakeWeightValue).forEach((element, index) => {
            element.onclick = () => {
                switch (index) {
                    case 0:
                        cakeWeight.value = 3;
                        changeWeightInfo(3);
                        break;
                    case 1:
                        cakeWeight.value = 6;
                        changeWeightInfo(6);
                        break;
                    case 2:
                        cakeWeight.value = 9;
                        changeWeightInfo(9);
                        break;
                    case 3:
                        cakeWeight.value = 12;
                        changeWeightInfo(12);
                        break;
                    case 4:
                        cakeWeight.value = 18;
                        changeWeightInfo(18);
                        break;
                    default:
                        cakeWeight.value = 3;
                        changeWeightInfo(3);
                        break;
                }
            }
        });

        cakeWeight.oninput = function() {
            changeWeightInfo(this.value);
        }

        cakeWeight.onchange = function() {
            changeWeightInfo(this.value);
        }

        changeWeightInfo = (value = 3, portions = 5) => {
            outputCakeWeight.children[0].innerHTML = `${value} кг`;
            outputCakeWeight.children[1].innerHTML = `хз порций`; //ну рэально
        }
    </script>
    <script src="js/splide/splide.min.js"></script>
    <!-- Инициализация splide -->
    <script>
        var splide = new Splide( '#image-slider', {
            perPage: 4,
            perMove: 1,
            rewind : true,
        });
        splide.mount();
    </script>
    <!-- Drag-&-Drop -->
    <script>
        let dropArea = document.getElementById('dropArea');
        let formButton = document.getElementById('fileElem');
        let filesArray = [];

        dropArea.onclick = (e) => {
            formButton.click();
        }
        formButton.addEventListener('change', buttonChange, false);

        function buttonChange(event) {
            let files = formButton.files;
            handleFiles(files);
        }

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropArea.classList.add('highlight');
        }

        function unhighlight(e) {
            dropArea.classList.remove('highlight');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            let dt = e.dataTransfer;
            let files = dt.files;

            handleFiles(files);
        }

        async function previewFile(file) {
            let reader = new FileReader();
            let gallery = document.getElementById('gallery');
            reader.readAsDataURL(file);
            reader.onloadend = await function() {
                let imageContainer = document.createElement('div');
                let img = document.createElement('img');
                let crossHover = document.createElement('div');
                let cross = document.createElement('div');
                
                imageContainer.classList.add('imageBlock');
                crossHover.classList.add('cross-hover');
                cross.classList.add('cross');
                img.src = reader.result;

                crossHover.appendChild(cross);
                imageContainer.appendChild(img);
                imageContainer.appendChild(crossHover);

                // crossHover.addEventListener('click', removeImage, false);
                imageContainer.addEventListener('click', preventDefaults, false);

                gallery.appendChild(imageContainer);
            }

            // gallery.childNodes.forEach((image, index) => {
            //     console.log(image);
            //     image.onClick = (e) => {
            //         preventDefaults(e);
            //         filesArray.splice(index, 1);
            //         gallery.childNodes[index].remove();
            //     }
            // });
        }

        async function handleFiles(files) {
            files = [...files];

            filesArray = [ ...filesArray, ...files ];

            if (files.length != 0) {
                let dropAreaText = document.getElementById('dropArea').querySelectorAll('p');
                dropAreaText[0].style.display = 'none';
                dropAreaText[1].style.display = 'none';
            }

            document.getElementById('gallery').innerHTML = '';
            await filesArray.forEach(previewFile);

            // document.getElementById('gallery').childNodes.forEach((image, index) => {
            //     console.log(image);
            //     image.onClick = (e) => {
            //         // preventDefaults(e);
            //         filesArray.splice(index, 1);
            //         gallery.childNodes[index].remove();
            //     }
            // });
        }
    </script>
</body>
</html>